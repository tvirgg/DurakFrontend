# Документация по компонентам игры

## Обзор
Эта документация описывает основные компоненты, используемые в реализации игры, находящиеся в директории `src/game`. Описано назначение каждого компонента, его ключевая функциональность и взаимодействие с другими частями системы.

## Компоненты

### 1. `Lobby.js`
**Назначение:**
- Управляет лобби, в котором игроки ждут начала игры.
- Отображает количество подключенных игроков и ждет, пока наберется достаточно игроков для начала игры.

**Ключевая функциональность:**
- Использует `connectToSocket.js` для подключения к серверу и прослушивания событий `playerJoined`.
- Обновляет количество подключенных игроков в UI.
- Переходит к началу игры, когда подключается необходимое количество игроков.

### 2. `connectToSocket.js`
**Назначение:**
- Обрабатывает логику подключения к сокету для игры.

**Ключевая функциональность:**
- Подключает игрока к игровому серверу.
- Прослушивает события сокета, такие как `playerJoined`, для обновления статуса игры.
- Обрабатывает переподключения в случае разрывов соединения.

### 3. `GameStart.js`
**Назначение:**
- Управляет переходом от лобби к активной игре.
- Отвечает за инициацию игры.

**Ключевая функциональность:**
- Отправляет запрос `/start` на сервер, когда набрано необходимое количество игроков.
- Получает уведомление о начале игры и инициирует раздачу карт.
- Обновляет состояние, чтобы отразить начало игры.

### 4. `api/play.js`
**Назначение:**
- Содержит логику для обработки действий игроков во время игры, в частности для атак и защиты.

**Ключевая функциональность:**
- Отправляет запросы `/play` на сервер.
- Обрабатывает как атаки, так и защиты.
  - Для атаки: отправляет `attackCard`, чтобы указать, какая карта разыгрывается.
  - Для защиты: отправляет `attackCard` и `defendCard`, чтобы указать, какая карта защищается.
- Обрабатывает ответы сервера, включая ошибки (например, если ход невозможен).

### 5. `GameTable.js`
**Назначение:**
- Представляет основной интерфейс игры, где игроки делают ходы.

**Ключевая функциональность:**
- Отображает стол и карты каждого игрока.
- Обрабатывает действия игроков, такие как выбор карты для атаки или защиты.
- Обновляет позиции карт на столе в зависимости от статуса игры (атака или защита).
- Прослушивает изменения от событий сокета и обновляет состояние игры соответственно.

### 6. `GameTimer.js`
**Назначение:**
- Реализует функциональность таймера для управления длительностью хода.

**Ключевая функциональность:**
- Запускает таймер в начале каждого хода.
- Сбрасывает таймер после каждого действия игрока (запрос `/play`).
- По окончании времени вызывает `/finish-turn` с помощью `api/finishTurn.js`, чтобы завершить ход.

### 7. `api/finishTurn.js`
**Назначение:**
- Обрабатывает логику завершения хода игрока.

**Ключевая функциональность:**
- Отправляет запрос `/finish-turn` на сервер.
- При успешном ответе обновляет состояние игры, удаляя сыгранные карты и раздавая новые.

### 8. `CardAnimations.js`
**Назначение:**
- Управляет анимациями карт во время атак, защит и раздачи карт.

**Ключевая функциональность:**
- Использует функции из `touchevents`, `scriptedCardMoves` и `animationUtils` для управления движением карт.
- Обрабатывает анимации для размещения карт на столе, тряски карт в случае неверного хода и раздачи карт игрокам.

### 9. `GameContext.js`
**Назначение:**
- Обеспечивает общий контекст для состояния игры, позволяя легко получить доступ к текущим игровым данным в различных компонентах.

**Ключевая функциональность:**
- Хранит информацию об игроках, статусе игры, картах в игре и другую релевантную информацию.
- Позволяет таким компонентам, как `GameTable.js`, `GameTimer.js` и `GameStart.js`, получать и изменять состояние игры.

### Вспомогательные файлы для анимаций

#### `touchevents.js`
- Содержит обработчики событий касания и перетаскивания, используемых для перемещения карт на мобильных устройствах.

#### `scriptedCardMoves.js`
- Обеспечивает скриптованные движения карт, такие как раздача карт каждому игроку или перемещение карт с одной точки в другую.

#### `animationUtils.js`
- Содержит утилиты для различных анимаций, таких как тряска карты для указания неверного действия или плавное перемещение карт на столе.

## Рекомендуемый рабочий процесс
1. **Настройка лобби (`Lobby.js` и `connectToSocket.js`)**: Реализуйте лобби, где игроки ждут подключения других игроков, включая обработку событий сокета.
2. **Начало игры (`GameStart.js`)**: Когда достаточно игроков подключено, используйте `/start` для инициации игры и раздачи карт.
3. **Игровой процесс (`GameTable.js`, `api/play.js`)**: Реализуйте основной игровой цикл с атаками и защитами, используя запросы `/play` для обновления состояния игры.
4. **Управление ходами (`GameTimer.js`, `api/finishTurn.js`)**: Обеспечьте завершение ходов по истечении таймера и правильное удаление и перераспределение карт.
5. **Анимации (`CardAnimations.js`, вспомогательные файлы)**: Интегрируйте анимации на протяжении всей игры, чтобы она выглядела плавной и отзывчивой для всех действий.
